"use strict";(self.webpackChunkgraphiql_app_for_wp=self.webpackChunkgraphiql_app_for_wp||[]).push([[8337],{8337(e,t,o){o.r(t),o.d(t,{setupMode:()=>_});var i=o(5874),r=o(4467),s=o(6602);class n{constructor(e){(0,r.A)(this,"_defaults",void 0),(0,r.A)(this,"_idleCheckInterval",void 0),(0,r.A)(this,"_lastUsedTime",0),(0,r.A)(this,"_configChangeListener",void 0),(0,r.A)(this,"_worker",null),(0,r.A)(this,"_client",null),this._defaults=e,this._idleCheckInterval=window.setInterval(()=>this._checkIfIdle(),3e4),this._configChangeListener=this._defaults.onDidChange(()=>{this._stopWorker()})}_stopWorker(){this._worker&&(this._worker.dispose(),this._worker=null),this._client=null}dispose(){clearInterval(this._idleCheckInterval),this._configChangeListener.dispose(),this._stopWorker()}_checkIfIdle(){if(!this._worker)return;Date.now()-this._lastUsedTime>12e4&&this._stopWorker()}async _getClient(){if(this._lastUsedTime=Date.now(),!this._client&&!this._worker)try{const{languageId:e,formattingOptions:t,schemas:o,externalFragmentDefinitions:r,completionSettings:n}=this._defaults;this._worker=i.editor.createWebWorker({moduleId:"monaco-graphql/esm/GraphQLWorker.js",label:e,createData:{languageId:e,formattingOptions:t,languageConfig:{schemas:null===o||void 0===o?void 0:o.map(s.pu),externalFragmentDefinitions:r,fillLeafsOnComplete:n.__experimental__fillLeafsOnComplete}}}),this._client=this._worker.getProxy()}catch(e){console.error("error loading worker",e)}return this._client}async getLanguageServiceWorker(){const e=await this._getClient();for(var t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];return await this._worker.withSyncedResources(o),e}}var a=o(9379),l=o(214),d=o(2364);class c{constructor(e,t){let o;(0,r.A)(this,"defaults",void 0),(0,r.A)(this,"_worker",void 0),(0,r.A)(this,"_disposables",[]),(0,r.A)(this,"_listener",Object.create(null)),this.defaults=e,this._worker=t,this._worker=t;const i=t=>{var i;const r=(0,s.ph)(t);if(r!==this.defaults.languageId)return;const n=t.uri.toString(),a=null===(i=e.diagnosticSettings.validateVariablesJSON)||void 0===i?void 0:i[n];o=setTimeout(()=>{this._doValidate(t.uri,r,a)},400),this._listener[n]=t.onDidChangeContent(()=>{clearTimeout(o),o=setTimeout(()=>{this._doValidate(t.uri,r,a)},400)})},n=e=>{l.editor.setModelMarkers(e,this.defaults.languageId,[]);const t=e.uri.toString(),o=this._listener[t];o&&(o.dispose(),delete this._listener[t])};this._disposables.push(l.editor.onDidCreateModel(i),{dispose(){clearTimeout(o)}},l.editor.onWillDisposeModel(e=>{n(e)}),l.editor.onDidChangeModelLanguage(e=>{n(e.model),i(e.model)}),{dispose:()=>{for(const e of Object.values(this._listener))e.dispose()}},e.onDidChange(()=>{for(const e of l.editor.getModels())(0,s.ph)(e)===this.defaults.languageId&&(n(e),i(e))}));for(const r of l.editor.getModels())(0,s.ph)(r)===this.defaults.languageId&&i(r)}dispose(){for(const e of this._disposables)e.dispose();this._disposables=[]}async _doValidate(e,t,r){const s=await this._worker(e);if(!s)return;const n=await s.doValidation(e.toString());if(l.editor.setModelMarkers(l.editor.getModel(e),t,n),r){var d;if(await Promise.resolve().then(o.bind(o,6848)),!r.length)throw new Error("No variables URI strings provided to validate");const t=await s.doGetVariablesJSONSchema(e.toString());if(!t)return;const n=i.Uri.file(r[0].replace(".json","-schema.json")).toString(),l={uri:n,schema:t,fileMatch:r},c=(null===(d=i.languages.json.jsonDefaults.diagnosticsOptions.schemas)||void 0===d?void 0:d.filter(e=>e.uri!==n))||[];i.languages.json.jsonDefaults.setDiagnosticsOptions((0,a.A)((0,a.A)({schemaValidation:"error",validate:!0},this.defaults.diagnosticSettings.jsonDiagnosticSettings),{},{schemas:[...c,l],enableSchemaRequest:!1}))}}}const u=i.languages.CompletionItemKind,g={[d.Io.Text]:u.Text,[d.Io.Method]:u.Method,[d.Io.Function]:u.Function,[d.Io.Constructor]:u.Constructor,[d.Io.Field]:u.Field,[d.Io.Variable]:u.Variable,[d.Io.Class]:u.Class,[d.Io.Interface]:u.Interface,[d.Io.Module]:u.Module,[d.Io.Property]:u.Property,[d.Io.Unit]:u.Unit,[d.Io.Value]:u.Value,[d.Io.Enum]:u.Enum,[d.Io.Keyword]:u.Keyword,[d.Io.Snippet]:u.Snippet,[d.Io.Color]:u.Color,[d.Io.File]:u.File,[d.Io.Reference]:u.Reference,[d.Io.Folder]:u.Folder,[d.Io.EnumMember]:u.EnumMember,[d.Io.Constant]:u.Constant,[d.Io.Struct]:u.Struct,[d.Io.Event]:u.Event,[d.Io.Operator]:u.Operator,[d.Io.TypeParameter]:u.TypeParameter};function h(e){var t;var o;return{range:e.range,kind:(o=e.kind,o in g?g[o]:u.Text),label:e.label,insertText:null!==(t=e.insertText)&&void 0!==t?t:e.label,insertTextRules:e.insertText?i.languages.CompletionItemInsertTextRule.InsertAsSnippet:void 0,sortText:e.sortText,filterText:e.filterText,documentation:e.documentation,detail:e.detail,command:e.command}}class p{constructor(e){(0,r.A)(this,"_worker",void 0),this._worker=e,this._worker=e}get triggerCharacters(){return[":","$"," ","(","@"]}async provideCompletionItems(e,t,o,i){try{const o=await this._worker(e.uri);return{incomplete:!0,suggestions:(await o.doComplete(e.uri.toString(),t)).map(h)}}catch(r){return console.error("Error fetching completion items",r),{suggestions:[]}}}}class m{constructor(e){(0,r.A)(this,"_worker",void 0),this._worker=e,this._worker=e}async provideDocumentFormattingEdits(e,t,o){const i=await this._worker(e.uri),r=await i.doFormat(e.uri.toString());return r?[{range:e.getFullModelRange(),text:r}]:[]}}class f{constructor(e){(0,r.A)(this,"_worker",void 0),this._worker=e}async provideHover(e,t,o){const i=e.uri,r=await this._worker(e.uri),s=await r.doHover(i.toString(),t);return s?{range:s.range,contents:[{value:s.content}]}:{contents:[]}}dispose(){}}function _(e){const t=[],o=[],r=new n(e);t.push(r);const s=function(){try{return r.getLanguageServiceWorker(...arguments)}catch(e){throw new Error("Error fetching graphql language service worker")}};function a(){const{modeConfiguration:t,languageId:r}=e;t.documentFormattingEdits&&o.push(i.languages.registerDocumentFormattingEditProvider(r,new m(s)))}function l(t){const{modeConfiguration:r,languageId:n}=e;I(o),r.completionItems&&o.push(i.languages.registerCompletionItemProvider(n,new p(s))),r.diagnostics&&o.push(new c(t,s)),r.hovers&&o.push(i.languages.registerHoverProvider(n,new f(s))),a()}let{modeConfiguration:d,formattingOptions:u,diagnosticSettings:g,externalFragmentDefinitions:h,schemas:_}=e;return l(e),e.onDidChange(e=>{e.modeConfiguration!==d&&(d=e.modeConfiguration,l(e)),e.formattingOptions!==u&&(u=e.formattingOptions,a()),e.externalFragmentDefinitions!==h&&(h=e.externalFragmentDefinitions,l(e)),e.diagnosticSettings!==g&&(g=e.diagnosticSettings,l(e)),e.schemas!==_&&(_=e.schemas,l(e))}),t.push(w(o)),w(t)}function w(e){return{dispose:()=>I(e)}}function I(e){for(;e.length;)e.pop().dispose()}}}]);
//# sourceMappingURL=8337.c707510d.chunk.js.map